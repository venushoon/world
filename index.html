<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🇫🇷 프랑스 메모리 게임 — 난이도/콤보/사운드</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(180deg,#f8fafc 0%,#eef2ff 100%); }
    .board { max-width: 1400px; }
    .perspective { perspective: 1200px; }
    .card { width: 180px; height: 140px; }
    .inner { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transform-origin: center center; transition: transform .35s; }
    .card.flipped .inner { transform: rotateY(180deg); }
    .face { position: absolute; inset: 0; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; border-radius: 1rem; display:flex; align-items:center; justify-content:center; }
    .front { background: white; }
    .back  { background: white; transform: rotateY(180deg); }
    .shadow-soft { box-shadow: 0 10px 20px rgba(2,6,23,.08), 0 6px 6px rgba(2,6,23,.06); }
  </style>
</head>
<body class="min-h-screen py-8 text-slate-800">
  <main class="mx-auto board px-4">
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">🇫🇷 프랑스 메모리 게임</h1>
        <p id="set-indicator" class="text-slate-600 mt-1">현재 세트: <b>대표(혼합)</b> · 2행 고정</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <label class="text-sm text-slate-600">세트
          <select id="dataset" class="ml-2 px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow-soft">
            <option value="classic">대표 (혼합)</option>
            <option value="art">예술 중심</option>
            <option value="landmarks">랜드마크 중심</option>
            <option value="food">음식 포함</option>
          </select>
        </label>
        <label class="text-sm text-slate-600">난이도
          <select id="difficulty" class="ml-2 px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow-soft">
            <option value="5">보통 (10장)</option>
            <option value="6">어려움 (12장)</option>
            <option value="8">매우 어려움 (16장)</option>
          </select>
        </label>
        <label class="text-sm text-slate-600">제한시간
          <select id="timelimit" class="ml-2 px-3 py-2 rounded-xl bg-white ring-1 ring-slate-200 shadow-soft">
            <option value="60">60초</option>
            <option value="90" selected>90초</option>
            <option value="120">120초</option>
            <option value="0">무제한</option>
          </select>
        </label>
        <button id="btn-new" class="px-4 py-2 rounded-xl bg-slate-900 text-white font-semibold shadow-soft hover:opacity-90 active:opacity-80">새 게임</button>
        <button id="btn-hint" class="px-4 py-2 rounded-xl bg-white ring-1 ring-slate-200 font-semibold shadow-soft hover:bg-slate-50">정답 힌트 (3초)</button>
      </div>
    </header>

    <section class="flex items-center flex-wrap gap-6 mb-3">
      <div class="flex items-center gap-2 text-slate-700"><span class="text-sm">이동 수:</span><span id="moves" class="text-lg font-bold">0</span></div>
      <div class="flex items-center gap-2 text-slate-700"><span class="text-sm">성공 쌍:</span><span id="matches" class="text-lg font-bold">0/5</span></div>
      <div class="flex items-center gap-2 text-slate-700"><span class="text-sm">콤보:</span><span id="combo" class="text-lg font-bold">x0</span></div>
      <div class="flex items-center gap-2 text-slate-700"><span class="text-sm">점수:</span><span id="score" class="text-lg font-bold">0</span></div>
      <div class="flex items-center gap-2 text-slate-700"><span class="text-sm">남은 시간:</span><span id="time" class="text-lg font-bold">∞</span></div>
      <div class="ml-auto text-sm text-slate-500">정답 +10점 + 콤보보너스(+5×콤보단계), 오답 −2점</div>
    </section>

    <section id="board" class="grid gap-4 place-items-center"></section>
  </main>

  <template id="tpl-card">
    <button class="card relative perspective rounded-2xl focus:outline-none focus:ring-4 ring-indigo-200 shadow-soft group" aria-label="카드">
      <div class="inner w-full h-full">
        <div class="face front w-full h-full flex flex-col items-center justify-center">
          <div class="text-2xl">🃏</div>
          <div class="mt-1 text-sm text-slate-500">뒤집어 보세요</div>
        </div>
        <div class="face back w-full h-full flex items-center justify-center p-3"></div>
      </div>
    </button>
  </template>

  <script>
    const $=(s,e=document)=>e.querySelector(s);
    const $$=(s,e=document)=>Array.from(e.querySelectorAll(s));
    const shuffle=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};

    // 데이터 세트
    const DATASETS = {
      classic: [
        { id:'eiffel', ko:'에펠탑', hint:'Tour Eiffel', img:'https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg' },
        { id:'mona', ko:'모나리자', hint:'Mona Lisa', img:'https://upload.wikimedia.org/wikipedia/commons/6/6a/Mona_Lisa.jpg' },
        { id:'louvre', ko:'루브르 박물관', hint:'Musée du Louvre', img:'https://upload.wikimedia.org/wikipedia/commons/a/af/Louvre_Museum_Wikimedia_Commons.jpg' },
        { id:'arc', ko:'개선문', hint:'Arc de Triomphe', img:'https://upload.wikimedia.org/wikipedia/commons/6/6d/Arc_de_Triomphe_Paris_Wikimedia_Commons.jpg' },
        { id:'versailles', ko:'베르사유 궁전', hint:'Palais de Versailles', img:'https://upload.wikimedia.org/wikipedia/commons/5/5d/Palace_of_Versailles_Wikimedia_Commons.jpg' },
        { id:'notre', ko:'노트르담 대성당', hint:'Notre-Dame', img:'https://upload.wikimedia.org/wikipedia/commons/a/a6/Notre_Dame_de_Paris_2013-07-24.jpg' },
        { id:'mont', ko:'몽생미셸', hint:'Mont-Saint-Michel', img:'https://upload.wikimedia.org/wikipedia/commons/0/02/Mont-Saint-Michel_from_above.jpg' },
        { id:'chambord', ko:'샹보르 성', hint:'Château de Chambord', img:'https://upload.wikimedia.org/wikipedia/commons/8/89/Chateau_Chambord.jpg' }
      ],
      art: [
        { id:'mona', ko:'모나리자', hint:'Mona Lisa', img:'https://upload.wikimedia.org/wikipedia/commons/6/6a/Mona_Lisa.jpg' },
        { id:'venus', ko:'사모트라케의 니케', hint:'Winged Victory', img:'https://upload.wikimedia.org/wikipedia/commons/3/3c/Winged_Victory_of_Samothrace_-_Louvre.jpg' },
        { id:'milov', ko:'밀로의 비너스', hint:'Venus de Milo', img:'https://upload.wikimedia.org/wikipedia/commons/7/7d/Venus_de_Milo_Louvre_Ma399_n4.jpg' },
        { id:'orsee', ko:'오르세 미술관', hint:"Musée d'Orsay", img:'https://upload.wikimedia.org/wikipedia/commons/1/1e/Mus%C3%A9e_d%27Orsay_Inside.jpg' },
        { id:'monet', ko:'수련', hint:'Monet Water Lilies', img:'https://upload.wikimedia.org/wikipedia/commons/2/2e/Monet_Water_Lilies_1916.jpg' },
        { id:'rodin', ko:'생각하는 사람', hint:'Rodin The Thinker', img:'https://upload.wikimedia.org/wikipedia/commons/5/5f/Le_Penseur_de_Rodin.jpg' },
        { id:'delacroix', ko:'민중을 이끄는 자유의 여신', hint:'Delacroix', img:'https://upload.wikimedia.org/wikipedia/commons/4/4d/Eug%C3%A8ne_Delacroix_-_La_libert%C3%A9_guidant_le_peuple.jpg' },
        { id:'giverny', ko:'지베르니 정원', hint:'Giverny Garden', img:'https://upload.wikimedia.org/wikipedia/commons/1/12/Monet%27s_garden_in_Giverny_2012.jpg' }
      ],
      landmarks: [
        { id:'eiffel', ko:'에펠탑', hint:'Tour Eiffel', img:'https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg' },
        { id:'notre', ko:'노트르담 대성당', hint:'Notre-Dame', img:'https://upload.wikimedia.org/wikipedia/commons/a/a6/Notre_Dame_de_Paris_2013-07-24.jpg' },
        { id:'mont', ko:'몽생미셸', hint:'Mont-Saint-Michel', img:'https://upload.wikimedia.org/wikipedia/commons/0/02/Mont-Saint-Michel_from_above.jpg' },
        { id:'arc', ko:'개선문', hint:'Arc de Triomphe', img:'https://upload.wikimedia.org/wikipedia/commons/6/6d/Arc_de_Triomphe_Paris_Wikimedia_Commons.jpg' },
        { id:'versailles', ko:'베르사유 궁전', hint:'Palais de Versailles', img:'https://upload.wikimedia.org/wikipedia/commons/5/5d/Palace_of_Versailles_Wikimedia_Commons.jpg' },
        { id:'sacre', ko:'사크레쾨르 대성당', hint:'Sacré-Cœur', img:'https://upload.wikimedia.org/wikipedia/commons/6/6b/Sacre_Coeur_2011.jpg' },
        { id:'pontgard', ko:'퐁뒤가르', hint:'Pont du Gard', img:'https://upload.wikimedia.org/wikipedia/commons/7/77/Pont_du_Gard_BLS.jpg' },
        { id:'carcassonne', ko:'카르카손', hint:'Cité de Carcassonne', img:'https://upload.wikimedia.org/wikipedia/commons/7/70/Carcassonne_Cit%C3%A9_Walls.jpg' }
      ],
      food: [
        { id:'baguette', ko:'바게트', hint:'Baguette', img:'https://upload.wikimedia.org/wikipedia/commons/3/34/French_baguettes.jpg' },
        { id:'macaron', ko:'마카롱', hint:'Macaron', img:'https://upload.wikimedia.org/wikipedia/commons/0/0e/Macarons_in_Patisserie.jpg' },
        { id:'cheese', ko:'프랑스 치즈', hint:'Fromage', img:'https://upload.wikimedia.org/wikipedia/commons/3/36/French_cheese_assortment.jpg' },
        { id:'crepe', ko:'크레페', hint:'Crêpe', img:'https://upload.wikimedia.org/wikipedia/commons/4/4b/Crepes_dsc07085.jpg' },
        { id:'ratatouille', ko:'라따뚜이', hint:'Ratatouille', img:'https://upload.wikimedia.org/wikipedia/commons/5/50/Ratatouille.jpg' },
        { id:'louvre', ko:'루브르 박물관', hint:'Musée du Louvre', img:'https://upload.wikimedia.org/wikipedia/commons/a/af/Louvre_Museum_Wikimedia_Commons.jpg' },
        { id:'eiffel', ko:'에펠탑', hint:'Tour Eiffel', img:'https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg' },
        { id:'mont', ko:'몽생미셸', hint:'Mont-Saint-Michel', img:'https://upload.wikimedia.org/wikipedia/commons/0/02/Mont-Saint-Michel_from_above.jpg' }
      ]
    };

    // 사운드(경량 톤)
    let audioCtx; function beep(f=660,d=120,t='sine',v=.2){ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type=t;o.frequency.value=f;g.gain.value=v;o.connect(g);g.connect(audioCtx.destination);o.start();setTimeout(()=>o.stop(),d); }
    const sfx={ flip:()=>beep(700,70,'triangle',.07), match:()=>{beep(520,90);setTimeout(()=>beep(780,120),90)}, wrong:()=>beep(220,130,'sawtooth',.08), win:()=>[523,659,784].forEach((f,i)=>setTimeout(()=>beep(f,120),i*140)), timeup:()=>[400,300,220].forEach((f,i)=>setTimeout(()=>beep(f,180,'square',.15),i*200)) };

    // 상태
    let deck=[], first=null, second=null, lock=false; let moves=0, matches=0, score=0, combo=0; let pairTarget=5; let timer=null, remain=0;

    function buildDeck(ds){ const src=DATASETS[ds]||DATASETS.classic; const chosen=src.slice(0,pairTarget); return shuffle(chosen.flatMap(item=>[{pair:item.id,kind:'image',label:item.ko,hint:item.hint,img:item.img},{pair:item.id,kind:'word',label:item.ko,hint:item.hint}])) }

    function preloadImages(list){ list.filter(c=>c.kind==='image').forEach(c=>{ const im=new Image(); im.referrerPolicy='no-referrer'; im.src=c.img; }); }

    function updateHUD(){ $('#moves').textContent=moves; $('#matches').textContent=`${matches}/${pairTarget}`; $('#combo').textContent=`x${combo}`; $('#score').textContent=score; $('#time').textContent=(remain===Infinity)?'∞':`${remain}s`; }

    function createCardEl(card, idx){
      const tpl=$('#tpl-card'); const el=tpl.content.firstElementChild.cloneNode(true);
      el.dataset.pair=card.pair; el.dataset.kind=card.kind; el.dataset.index=idx;
      const back=$('.back',el);
      if(card.kind==='image'){
        const img=document.createElement('img');
        const bust = (card.img.indexOf('?')>-1?'&':'?')+'v=' + Math.floor(Math.random()*1e6); // 캐시 무력화
        img.src = card.img + bust;
        img.alt = card.label + ' 사진';
        img.referrerPolicy = 'no-referrer';
        img.loading='lazy'; img.className='max-h-[110px] object-contain';
        img.onerror=()=>{ const fb=document.createElement('div'); fb.className='text-xs text-slate-500 text-center'; fb.textContent='이미지 로딩 실패 · '+card.label; img.replaceWith(fb); };
        back.appendChild(img);
      } else {
        const box=document.createElement('div'); box.className='text-center';
        const main=document.createElement('div'); main.className='text-lg font-bold'; main.textContent=card.label;
        const sub=document.createElement('div'); sub.className='text-xs text-slate-500 mt-1'; sub.textContent=card.hint||'';
        box.appendChild(main); box.appendChild(sub); back.appendChild(box);
      }
      el.addEventListener('click',()=>onFlip(el));
      return el;
    }

    function render(){ const board=$('#board'); board.innerHTML=''; board.style.gridTemplateColumns=`repeat(${pairTarget},minmax(0,1fr))`; const size=pairTarget>=8?'w-[150px] h-[115px]':pairTarget>=6?'w-[165px] h-[125px]':'w-[180px] h-[140px]'; deck.forEach((c,i)=>{ const el=createCardEl(c,i); el.classList.add(...size.split(' ')); board.appendChild(el); }); }

    function onFlip(el){ if(lock||el.classList.contains('matched')||el.classList.contains('flipped')) return; el.classList.add('flipped'); sfx.flip(); if(!first){ first=el; return; } second=el; lock=true; moves++; updateHUD(); const isMatch=first.dataset.pair===second.dataset.pair && first.dataset.kind!==second.dataset.kind; if(isMatch){ setTimeout(()=>{ first.classList.add('matched'); second.classList.add('matched'); first.setAttribute('disabled','true'); second.setAttribute('disabled','true'); first=second=null; lock=false; matches++; combo++; score += 10 + Math.max(0,combo-1)*5; updateHUD(); sfx.match(); if(matches===pairTarget) win(); },260); } else { setTimeout(()=>{ first.classList.remove('flipped'); second.classList.remove('flipped'); first=second=null; lock=false; score=Math.max(0,score-2); combo=0; updateHUD(); sfx.wrong(); },800);} }

    function win(){ stopTimer(); sfx.win(); alert(`성공! 점수 ${score}점, 이동수 ${moves}회, 최고 콤보 x${combo}`); }
    function timeUp(){ sfx.timeup(); alert(`시간 종료! 점수 ${score}점, 성공 ${matches}/${pairTarget}`); }

    function startTimer(sec){ stopTimer(); if(sec===0){ remain=Infinity; updateHUD(); return; } remain=sec; updateHUD(); timer=setInterval(()=>{ if(remain===Infinity) return; remain--; updateHUD(); if(remain<=0){ stopTimer(); lock=true; $$('#board .card').forEach(el=>el.setAttribute('disabled','true')); timeUp(); } },1000); }
    function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

    function newGame(){ const ds=$('#dataset').value; pairTarget=parseInt($('#difficulty').value,10)||5; const tl=parseInt($('#timelimit').value,10); moves=0;matches=0;score=0;combo=0; first=second=null; lock=false; deck=buildDeck(ds); preloadImages(deck); render(); startTimer(tl); $('#set-indicator').innerHTML = `현재 세트: <b>${$('#dataset').selectedOptions[0].textContent}</b> · 2행 고정`; updateHUD(); }
    function hint3sec(){ const arr=$$('#board .card'); const show=arr.filter(el=>!el.classList.contains('matched')&&!el.classList.contains('flipped')); show.forEach(el=>el.classList.add('flipped')); setTimeout(()=>show.forEach(el=>el.classList.remove('flipped')),3000); }

    // 이벤트
    $('#btn-new').addEventListener('click',newGame);
    $('#btn-hint').addEventListener('click',hint3sec);
    $('#dataset').addEventListener('change',newGame);
    $('#difficulty').addEventListener('change',newGame);
    $('#timelimit').addEventListener('change',newGame);
    newGame();
  </script>
</body>
</html>
