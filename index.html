<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ ë©”ëª¨ë¦¬ ê²Œì„ â€” ë‚œì´ë„/ì½¤ë³´</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(180deg,#f8fafc 0%,#eef2ff 100%); }
    .board { max-width: 1180px; }
    .perspective { perspective: 1200px; }
    .card { width: 160px; height: 120px; }
    .inner { position: relative; width:100%; height:100%; transform-style: preserve-3d; transition: transform 0.6s; }
    .card.flipped .inner { transform: rotateY(180deg); }
    .face { position:absolute; width:100%; height:100%; backface-visibility:hidden; -webkit-backface-visibility:hidden; border-radius:1rem; display:flex; align-items:center; justify-content:center; }
    .front { background:#fff; flex-direction:column; }
    .back { background:#fff; transform:rotateY(180deg); }
    .shadow-soft { box-shadow:0 10px 20px rgba(2,6,23,.08),0 6px 6px rgba(2,6,23,.06); }
  </style>
</head>
<body class="min-h-screen py-8 text-slate-800">
  <main class="mx-auto board px-4">
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ ë©”ëª¨ë¦¬ ê²Œì„</h1>
        <p class="text-slate-600 mt-1">ë‚œì´ë„ì™€ ì„¸íŠ¸ë¥¼ ì„ íƒí•´ ì¦ê²¨ë³´ì„¸ìš”!</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <label class="text-sm text-slate-600">ì„¸íŠ¸
          <select id="dataset" class="ml-2 px-2 py-1 rounded bg-white ring-1 ring-slate-200">
            <option value="classic">ëŒ€í‘œ</option>
            <option value="art">ì˜ˆìˆ </option>
            <option value="landmarks">ëœë“œë§ˆí¬</option>
            <option value="food">ìŒì‹</option>
          </select>
        </label>
        <label class="text-sm text-slate-600">ë‚œì´ë„
          <select id="difficulty" class="ml-2 px-2 py-1 rounded bg-white ring-1 ring-slate-200">
            <option value="10">10ì¥(ê¸°ë³¸)</option>
            <option value="12">12ì¥</option>
            <option value="16">16ì¥</option>
          </select>
        </label>
        <label class="text-sm text-slate-600">ì‹œê°„
          <select id="timelimit" class="ml-2 px-2 py-1 rounded bg-white ring-1 ring-slate-200">
            <option value="60">60ì´ˆ</option>
            <option value="90" selected>90ì´ˆ</option>
            <option value="120">120ì´ˆ</option>
            <option value="0">ë¬´ì œí•œ</option>
          </select>
        </label>
        <button id="btn-new" class="px-3 py-1 rounded bg-slate-900 text-white font-semibold">ìƒˆ ê²Œì„</button>
        <button id="btn-hint" class="px-3 py-1 rounded bg-white ring-1 ring-slate-200 font-semibold">íŒíŠ¸</button>
      </div>
    </header>

    <section class="flex flex-wrap gap-6 mb-3">
      <div>ì´ë™: <span id="moves">0</span></div>
      <div>ì„±ê³µ: <span id="matches">0</span></div>
      <div>ì ìˆ˜: <span id="score">0</span></div>
      <div>ì½¤ë³´: <span id="combo">0</span></div>
      <div>ì‹œê°„: <span id="time">âˆ</span></div>
    </section>

    <section id="board" class="grid grid-cols-5 gap-3 place-items-center"></section>
  </main>

  <template id="tpl-card">
    <button class="card relative perspective shadow-soft" aria-label="ì¹´ë“œ">
      <div class="inner">
        <div class="face front">ğŸƒ</div>
        <div class="face back"></div>
      </div>
    </button>
  </template>

  <script>
    function placeholderDataURL(label){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='320' height='220'>
        <rect width='100%' height='100%' fill='#e5e7eb'/>
        <text x='50%' y='50%' text-anchor='middle' dominant-baseline='middle'
          font-family='sans-serif' font-size='18' fill='#475569'>${label}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    const DATASETS={classic:[{id:'eiffel',ko:'ì—í íƒ‘',img:'https://upload.wikimedia.org/wikipedia/commons/a/a8/Tour_Eiffel_Wikimedia_Commons.jpg'},{id:'mona',ko:'ëª¨ë‚˜ë¦¬ì',img:'https://upload.wikimedia.org/wikipedia/commons/6/6a/Mona_Lisa.jpg'},{id:'louvre',ko:'ë£¨ë¸Œë¥´',img:'https://upload.wikimedia.org/wikipedia/commons/a/af/Louvre_Museum_Wikimedia_Commons.jpg'},{id:'arc',ko:'ê°œì„ ë¬¸',img:'https://upload.wikimedia.org/wikipedia/commons/6/6d/Arc_de_Triomphe_Paris_Wikimedia_Commons.jpg'},{id:'versailles',ko:'ë² ë¥´ì‚¬ìœ ',img:'https://upload.wikimedia.org/wikipedia/commons/5/5d/Palace_of_Versailles_Wikimedia_Commons.jpg'},{id:'notre',ko:'ë…¸íŠ¸ë¥´ë‹´',img:'https://upload.wikimedia.org/wikipedia/commons/a/a6/Notre_Dame_de_Paris_2013-07-24.jpg'},{id:'mont',ko:'ëª½ìƒë¯¸ì…¸',img:'https://upload.wikimedia.org/wikipedia/commons/0/02/Mont-Saint-Michel_from_above.jpg'},{id:'baguette',ko:'ë°”ê²ŒíŠ¸',img:'https://upload.wikimedia.org/wikipedia/commons/3/34/French_baguettes.jpg'}]};

    let deck=[]; let first=null,second=null,lock=false;
    let moves=0,matches=0,score=0,combo=0;
    let timer=null,remain=0;

    const $=(s,e=document)=>e.querySelector(s);
    const $$=(s,e=document)=>[...e.querySelectorAll(s)];
    const shuffle=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};

    // ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ ëŒ€ì²´ìš© SVG ë°ì´í„° URL ìƒì„±
    function placeholderDataURL(label){
      var svg = "<svg xmlns='http://www.w3.org/2000/svg' width='320' height='220'>"+
                "<rect width='100%' height='100%' fill='#e5e7eb'/>"+
                "<text x='50%' y='50%' text-anchor='middle' dominant-baseline='middle'"+
                " font-family='sans-serif' font-size='18' fill='#475569'>"+ label +"</text>"+
                "</svg>";
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    function buildDeck(){
      const ds=DATASETS[$('#dataset').value]||DATASETS.classic;
      const diff=parseInt($('#difficulty').value,10);
      const needed=(diff/2);
      const chosen=ds.slice(0,needed);
      const pairs=chosen.flatMap(item=>[
        {pair:item.id,kind:'image',label:item.ko,img:item.img},
        {pair:item.id,kind:'word',label:item.ko}
      ]);
      return shuffle(pairs);
    }

    function updateHUD(){
      $('#moves').textContent=moves;
      $('#matches').textContent=matches;
      $('#score').textContent=score;
      $('#combo').textContent=combo;
      $('#time').textContent=remain===Infinity?'âˆ':remain+'s';
    }

    function createCardEl(card){
      const tpl=$('#tpl-card');
      const el=tpl.content.firstElementChild.cloneNode(true);
      el.dataset.pair=card.pair; el.dataset.kind=card.kind;
      const back=$('.back',el);
      if(card.kind==='image'){
        const img=document.createElement('img');
        img.src = card.img;
        img.alt = card.label + ' ì‚¬ì§„';
        img.referrerPolicy = 'no-referrer';
        img.className = 'max-h-[90px] object-contain';
        img.onerror = function(){
          const fallback = document.createElement('div');
          fallback.className = 'text-xs text-slate-500 text-center';
          fallback.textContent = 'ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨ Â· ' + card.label;
          img.replaceWith(fallback);
        };
        back.appendChild(img);
      } else {
        const box = document.createElement('div');
        box.style.fontWeight = '700';
        box.textContent = card.label;
        back.appendChild(box);
      }
      el.addEventListener('click',()=>onFlip(el));
      return el;
    }

    function render(){
      const board=$('#board');
      board.innerHTML='';
      const diff=parseInt($('#difficulty').value,10);
      board.className='grid gap-3 place-items-center';
      board.style.gridTemplateColumns=`repeat(${diff/2}, minmax(0,1fr))`;
      deck.forEach(c=>board.appendChild(createCardEl(c)));
    }

    function onFlip(el){
      if(lock||el.classList.contains('matched')||el.classList.contains('flipped'))return;
      el.classList.add('flipped');
      if(!first){first=el;return;}
      second=el;lock=true;moves++;updateHUD();
      const isMatch=first.dataset.pair===second.dataset.pair&&first.dataset.kind!==second.dataset.kind;
      if(isMatch){
        setTimeout(()=>{
          first.classList.add('matched');second.classList.add('matched');
          matches++; score+=10+combo*2; combo++;
          resetPair();
          if(matches===deck.length/2)win();
        },300);
      }else{
        setTimeout(()=>{
          first.classList.remove('flipped');second.classList.remove('flipped');
          score=Math.max(0,score-2); combo=0;
          resetPair();
        },800);
      }
    }

    function resetPair(){first=second=null;lock=false;updateHUD();}

    function win(){stopTimer();alert(`ğŸ‰ ì„±ê³µ! ì ìˆ˜ ${score}ì , ì´ë™ ${moves}íšŒ`); newGame();}

    function startTimer(sec){
      stopTimer(); if(sec===0){remain=Infinity;updateHUD();return;}
      remain=sec;updateHUD();
      timer=setInterval(()=>{remain--;updateHUD(); if(remain<=0){stopTimer();alert('â° ì‹œê°„ ì¢…ë£Œ!'); newGame();}},1000);
    }
    function stopTimer(){if(timer){clearInterval(timer);timer=null;}}

    function hint(){const cards=$$('#board .card:not(.matched)');cards.forEach(c=>c.classList.add('flipped'));setTimeout(()=>cards.forEach(c=>c.classList.remove('flipped')),2000);}

    function newGame(){first=second=null;lock=false;moves=matches=score=combo=0;updateHUD();deck=buildDeck();render();startTimer(parseInt($('#timelimit').value,10));}

    $('#btn-new').addEventListener('click',newGame);
    $('#btn-hint').addEventListener('click',hint);
    $('#dataset').addEventListener('change',newGame);
    $('#difficulty').addEventListener('change',newGame);
    $('#timelimit').addEventListener('change',newGame);
    newGame();
  </script>
</body>
</html>
